DROP TABLE IF EXISTS user_authorities;
DROP TABLE IF EXISTS refresh_tokens;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS inquiries;


CREATE TABLE users (
    user_id uuid PRIMARY KEY DEFAULT uuidv7(),
    email VARCHAR(255) UNIQUE ,
    password VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_authorities (
    user_id uuid NOT NULL,
    authority VARCHAR(255),

    CONSTRAINT fk_user_authorities_users
        FOREIGN KEY (user_id)
            REFERENCES users (user_id)
            ON DELETE CASCADE
);

CREATE TABLE inquiries(
    inquiry_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR(255),
    title VARCHAR(255),
    message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE refresh_tokens (
    user_id uuid NOT NULL,
    token VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP + interval '7 days',

    CONSTRAINT fk_user_authorities_users
        FOREIGN KEY (user_id)
            REFERENCES users (user_id)
            ON DELETE CASCADE
);

CREATE INDEX idx_user_authorities_user_id ON user_authorities(user_id);